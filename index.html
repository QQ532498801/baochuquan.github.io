<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="包楚权,楚权,baochuquan,chuquan,iOS,前端,Objective-C,JavaScript" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="吸收、沉淀、积累">
<meta property="og:type" content="website">
<meta property="og:title" content="包楚权的博客">
<meta property="og:url" content="http://chuquan.me/index.html">
<meta property="og:site_name" content="包楚权的博客">
<meta property="og:description" content="吸收、沉淀、积累">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="包楚权的博客">
<meta name="twitter:description" content="吸收、沉淀、积累">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://chuquan.me/"/>





  <title>包楚权的博客</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?030cf08d5b27d756fa9aeecb1130fe13";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>










</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">包楚权的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Seek the wonder of life.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/index.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://chuquan.me/2018/02/07/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="包楚权">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/slamdunk.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="包楚权的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/07/hello-world/" itemprop="url">Hello World</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-02-07T10:57:15+08:00">
                2018-02-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://chuquan.me/2018/02/07/Hello-World/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="包楚权">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/slamdunk.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="包楚权的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/07/Hello-World/" itemprop="url">Hello World</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-02-07T00:56:09+08:00">
                2018-02-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://chuquan.me/2018/02/06/ios-reverse-engineering-basis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="包楚权">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/slamdunk.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="包楚权的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/06/ios-reverse-engineering-basis/" itemprop="url">iOS逆向工程——基础篇</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-02-06T22:03:03+08:00">
                2018-02-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="一、iOS文件系统"><a href="#一、iOS文件系统" class="headerlink" title="一、iOS文件系统"></a>一、iOS文件系统</h1><p>iOS由OSX演化而来，而OSX又是基于UNIX的，它们都是类UNIX操作系统。类UNIX操作系统有一套标准的文件系统——<a href="https://wylmer.gitbooks.io/filesystem-hierarchy-standard/content/" target="_blank" rel="noopener">Filesystem Hierarchy Standard（FHS）</a>，其常用目录结构如下所示：</p>
<ul>
<li><code>/</code>：根目录</li>
<li><code>/bin</code>：binary，存放用户级基础功能的二进制文件，如<code>ls</code>、<code>ps</code>等</li>
<li><code>/boot</code>：存放能使系统成功启动的所有文件。<strong>iOS中此目录为空</strong></li>
<li><code>/dev</code>：device，存放BSD设备文件。每个文件代表系统的一个块设备或字符设备。块设备以块为单位传输数据，如硬盘；字符设备以字符为单位传输数据，如调制解调器</li>
<li><code>/sbin</code>：system binaries，存放提供系统级基础功的二进制文件，如<code>netstat</code>、<code>reboot</code>等</li>
<li><code>/etc</code>：法语Et Cetera（and so on的意思），存放系统脚本及配置文件，如<code>passwd</code>、<code>hosts</code>。iOS中，<code>/etc</code>是一个符号链接，实际指向<code>/private/etc</code></li>
<li><code>/lib</code>：存放系统库文件、内核模块及设备驱动等。<strong>iOS中此目录为空</strong></li>
<li><code>/mnt</code>：mount，存放临时的文件系统挂载点。<strong>iOS中此目录为空</strong></li>
<li><code>/private</code>：存放两个目录，分别是<code>/private/etc</code>和<code>/private/var</code></li>
<li><code>/tmp</code>：临时目录。iOS中，<code>/tmp</code>是一个符号链接，实际指向<code>/private/var/tmp</code></li>
<li><code>/usr</code>：包含大多数用户和程序。<ul>
<li><code>/usr/bin</code>：包含那些<code>/bin</code>和<code>/sbin</code>中未出现的基础功能，如<code>nm</code>、<code>killall</code>等</li>
<li><code>/usr/include</code>：包含所有的标准C头文件</li>
<li><code>/usr/lib</code>：存放库文件</li>
</ul>
</li>
<li><code>/var</code>：variable，存放一些经常更改的文件，如日志、用户数据、临时文件等。<ul>
<li><code>/var/mobile</code>：存放了mobile用户的文件。<strong>逆向工程重点关注目录</strong></li>
<li><code>/var/root</code>：存放了root用户的文件</li>
</ul>
</li>
</ul>
<h2 id="1-iOS独有目录"><a href="#1-iOS独有目录" class="headerlink" title="1. iOS独有目录"></a>1. iOS独有目录</h2><p>下图所示分别是OSX和iOS的根目录结构，与FHS还是有一定的区别。</p>
<div align="center"><img src="http://chuquan-public-r-001.oss-cn-shanghai.aliyuncs.com/blog-images/ios-reverse-fhs001.png" alt=""></div>


<p>对于iOS，其独有的目录如下思维导图所示：</p>
<div align="center"><img src="http://chuquan-public-r-001.oss-cn-shanghai.aliyuncs.com/blog-images/ios-reverse-fhs002.png?x-oss-process=image/resize,w_500" alt=""></div>

<ul>
<li><code>/Applications</code>：存放所有的<strong>系统App</strong>和<strong>来自于Cydia的App</strong>，不包括StoreApp</li>
<li><code>/Developer</code>：如果一台设备连接Xcode后被指定为调试机，Xcode就会在iOS中生成该目录<ul>
<li><code>/Developer/Applications</code></li>
<li><code>/Developer/Library</code></li>
<li><code>/Developer/Tools</code></li>
<li><code>/Developer/usr</code></li>
</ul>
</li>
<li><code>/Library</code>：存放一些提供系统支持的数据<ul>
<li><code>/Library/MobileSubstrate/DynamicLibraries</code>：<strong>存放Cydia安装程序的<code>.plist</code>和<code>.dylib</code>文件</strong></li>
</ul>
</li>
<li><code>/System/Library</code>：iOS文件系统中最重要的目录之一，存放大量系统组件<ul>
<li><code>/System/Library/Frameworks</code>：<strong>存放iOS中各种日常使用的framework</strong></li>
<li><code>/System/Library/PrivateFrameworks</code>：<strong>存放iOS中未公开的私有framework</strong></li>
<li><code>/System/Library/CoreServices/SpringBoard.app</code>：iOS桌面管理器</li>
</ul>
</li>
<li><code>/User</code>：用户目录（<code>mobile</code>用户的<code>home</code>目录），实际指向<code>/var/mobile</code>，存放大量用户数据<ul>
<li><code>/var/mobile/Media/DCIM</code>：存放照片</li>
<li><code>/var/mobile/Media/Recording</code>：存放录音文件</li>
<li><code>/var/mobile/Library/SMS</code>：存放短信数据库</li>
<li><code>/var/mobile/Library/Mail</code>：存放邮件数据</li>
<li><code>/var/mobile/Containers</code>：<strong>存放StoreApp</strong>。<ul>
<li><code>/var/mobile/Containers/Bundle</code>：<strong>存放所有StoreApp的可执行文件和相关资源</strong></li>
<li><code>/var/mobile/Containers/Data</code>：<strong>存放所有StoreApp的数据，沙盒目录的真实目录</strong></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="2-iOS应用（StoreApp）沙盒"><a href="#2-iOS应用（StoreApp）沙盒" class="headerlink" title="2. iOS应用（StoreApp）沙盒"></a>2. iOS应用（StoreApp）沙盒</h2><p>出于安全考虑，iOS系统把每个应用（StoreApp）以及数据都放到一个沙盒（sandbox）里面，应用只能访问自己沙盒目录里面的文件、网络资源等（也有例外，比如系统通讯录、照相机、照片等能在用户授权的情况下被第三方应用访问）。</p>
<div align="center"><img src="http://chuquan-public-r-001.oss-cn-shanghai.aliyuncs.com/blog-images/ios-reverse-fhs004.png?x-oss-process=image/resize,w_500" alt=""></div>

<p>上图所示为沙盒结构，沙盒在逻辑上包含两个部分：<code>Bundle Container</code>和<code>Data Container</code>，两者在iOS文件系统中的位置是平行的，分别是<code>/var/mobile/Containers/Bundle</code>和<code>/var/mobile/Containers/Data</code>。实际开发中，通过<code>NSHomeDirectory()</code>方法获取到沙盒根目录对应的是<code>Data Container</code>的路径。</p>
<h3 id="I-Bundle-Container"><a href="#I-Bundle-Container" class="headerlink" title="I. Bundle Container"></a>I. Bundle Container</h3><p>bundle的概念源自于NeXTSTEP，它是一个按某种标准结构来组织的目录，其中包含了二进制文件及运行所需的资源。正向开发中常见的App和framework都是以bundle的形式存在。在越狱iOS中常见的PreferenceBundle是一种依附于Settings的App，结构与App类似，本质也是bundle。Framework也是bundle，但framework的bundle中存放的是一个dylib（动态库），而非可执行文件。</p>
<p>在正向开发时，我们上传至App Store的ipa（iPhone Application）包，解压后会有一个<code>Payload</code>目录，其内部又包含一个<code>.app</code>目录，这个目录就是一个App的目录结构，也是一个bundle。</p>
<p><code>Bundle Container</code>位于<code>/var/mobile/Containers/Bundle/Application/XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX/</code>主要用于存放静态资源，主要包含以下目录和文件：</p>
<ul>
<li><p><strong><code>MyApp.app</code></strong><br>  存放可执行文件和资源文件，包括：打包时的资源文件、本地文件、可执行文件、<code>.plist</code>文件。这个目录不会被iTunes同步。</p>
</li>
<li><p><strong><code>iTunesArtWork</code></strong></p>
</li>
<li><strong><code>iTunesMetadata.plist</code></strong></li>
</ul>
<h3 id="II-Data-Container"><a href="#II-Data-Container" class="headerlink" title="II. Data Container"></a>II. Data Container</h3><p><code>Data Container</code>位于<code>/var/mobile/Containers/Data/Application/YYYYYYYY-YYYY-YYYY-YYYYYYYYYYYY/</code>，主要用于存放App运行时产生的动态数据，其主要包含以下目录和文件：</p>
<ul>
<li><strong><code>Documents</code></strong><br>  存放应用运行时生成的并且需要保存的不可再生数据。注：iTunes或iCloud同步设备时会备份该目录</li>
<li><strong><code>Library</code></strong> <ul>
<li><strong><code>Library/Caches</code></strong><br>  存放应用运行时生成且需要保存的可再生数据，比如网络请求，用户需要负责删除对应文件。iTunes或iCloud不同步。</li>
<li><strong><code>Library/Preferences</code></strong><br>  存放偏好设置。使用<code>NSUserDefaults</code>写的设置数据都会保存在该目录下的一个<code>plist</code>文件中。iTunes或iCloud同步设备时备份该目录。</li>
</ul>
</li>
<li><strong><code>tmp</code></strong><br>  存放应用下次启动不再需要的临时文件。当应用不再需要这些文件的时候，需要主动将其删除。（当应用不再运行的时候，系统可能会将此目录清空。）这个目录不会被iTunes同步。</li>
</ul>
<p>在正向开发时，沙盒目录路径均有相应的获取方式，具体如下所示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// 沙盒目录</span><br><span class="line">NSLog(@&quot;%@&quot;,NSHomeDirectory());</span><br><span class="line">  </span><br><span class="line">// MyApp.app</span><br><span class="line">NSLog(@&quot;%@&quot;,[[NSBundle mainBundle] bundlePath]);</span><br><span class="line">  </span><br><span class="line">// Documents</span><br><span class="line">NSArray *paths = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES);</span><br><span class="line">NSString *docPath = [paths objectAtIndex:0];</span><br><span class="line">NSLog(@&quot;%@&quot;,docPath);</span><br><span class="line">  </span><br><span class="line">// Library</span><br><span class="line">NSArray *paths = NSSearchPathForDirectoriesInDomains(NSLibraryDirectory, NSUserDomainMask, YES);</span><br><span class="line">NSString *libPath = [paths objectAtIndex:0];</span><br><span class="line">NSLog(@&quot;%@&quot;,libPath);</span><br><span class="line">  </span><br><span class="line">// tmp</span><br><span class="line">NSLog(@&quot;%@&quot;,NSTemporaryDirectory());</span><br></pre></td></tr></table></figure></p>
<p>在逆向工程中，可以通过以下方式获取相关的目录：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 获取App的Bundle路径</span><br><span class="line">iphone: root# ps -e | grep appname</span><br><span class="line">  </span><br><span class="line">// 获取App的Data路径</span><br><span class="line">iphone: root# cycript -p appname</span><br><span class="line">cy# directory = NSHomeDirectory()</span><br></pre></td></tr></table></figure></p>
<h1 id="二、iOS二进制文件类型"><a href="#二、iOS二进制文件类型" class="headerlink" title="二、iOS二进制文件类型"></a>二、iOS二进制文件类型</h1><p>iOS逆向的目标主要包含三类二进制文件：<code>Application</code>、<code>Dynamic Library</code>、<code>Daemon</code>。</p>
<h2 id="1-Application"><a href="#1-Application" class="headerlink" title="1. Application"></a>1. Application</h2><p>Application，即我们最熟悉的App。App的Bundle目录有以下三个部分比较重要：</p>
<ul>
<li><p><code>Info.plist</code><br>  Info.plist记录了App的基本信息，如：<strong><code>bundle identifier</code></strong>、<strong>可执行文件名</strong>、<strong>图标文件名</strong>等。</p>
</li>
<li><p>可执行文件<br>  查看Info.plist，即可定位可执行文件</p>
</li>
<li><p>lproj目录<br>  lproj目录下存放的是各种本地化的字符串。</p>
</li>
</ul>
<h3 id="I-系统App-VS-StoreApp"><a href="#I-系统App-VS-StoreApp" class="headerlink" title="I. 系统App VS. StoreApp"></a>I. 系统App VS. StoreApp</h3><p><code>/Applications/</code>目录下存放<strong>系统App</strong>（包括CydiaApp）；<code>/var/mobile/Containers/</code>目录下存放<strong>StoreApp</strong>。其区别在于：</p>
<ul>
<li><p>目录结构<br>  两种App的Bundle目录区别不大，都含有Info.plist、可执行文件、lproj目录等。只是Data目录的位置不同：StoreApp的数据目录在<code>/var/mobile/Containers/Data/</code>下，以mobile权限运行的系统App的数据目录在<code>/var/mobile/</code>下，以root权限运行的系统App的数据目录在<code>/var/root/</code>下。</p>
</li>
<li><p>安装格式和权限<br>  Cydia App的安装格式一般是deb，StoreApp的安装格式一般是ipa。前者的属主用户和属主组一般是root和admin，能够以root权限运行；后者的属主用户和属主组都是mobile，只能以mobile权限运行。</p>
</li>
</ul>
<h2 id="2-Dynamic-Library"><a href="#2-Dynamic-Library" class="headerlink" title="2. Dynamic Library"></a>2. Dynamic Library</h2><p>Dynamic Library简称dylib，即动态链接库。在正向开发中，在Xcode工程中导入的各种framework，链接的各种lib，其本质都是dylib。</p>
<p>在iOS中，lib分为static和dynamic两种，其中static lib在编译阶段成为App可执行文件的一部分，会增加可执行文件的大小。dylib则不会改变可执行文件的大小，只有当App运行时调用到dylib时，iOS才会把它加载进内存，成为App进程的一部分。</p>
<p><strong>dylib是逆向工程的重要目标类型</strong>，但其本身并不是可执行文件，不能独立运行，只能为别的进程服务，而且它们寄生在别的进程里，成为这个进程的一部分。因此，dylib的权限是由它寄生的那个App决定的，同一个dylib寄生在系统App和StoreApp里时的权限是不同的。</p>
<p>越狱iOS中，Cydia里的各种tweak无一不是以dylib的形式工作的。</p>
<h2 id="3-Daemon"><a href="#3-Daemon" class="headerlink" title="3. Daemon"></a>3. Daemon</h2><p>iOS的daemon主要由一个可执行文件和一个plist文件构成。iOS的根进程是launchd，其会在开机时检查<code>/System/Library/LaunchDaemons</code>和<code>/Library/LaunchDaemons</code>下所有格式符合规定的plist文件，然后启动对应的daemon。这里的plist文件与App中的<code>Info.plist</code>文件作用类似，即记录Daemon的基本信息。</p>
<p>(完)</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li>《iOS应用逆向工程（第2版）》</li>
<li><a href="https://developer.apple.com/library/content/documentation/FileManagement/Conceptual/FileSystemProgrammingGuide/FileSystemOverview/FileSystemOverview.html" target="_blank" rel="noopener">File System Programming Guide</a></li>
<li><a href="http://www.cnblogs.com/wujy/archive/2016/02/13/5188302.html" target="_blank" rel="noopener">iOS底层基础知识-文件目录结构</a></li>
<li><a href="https://www.jianshu.com/p/9cc4f0975d1d" target="_blank" rel="noopener">iOS APP沙盒目录</a></li>
<li><a href="https://bbs.feng.com/read-htm-tid-249.html" target="_blank" rel="noopener">Mac OS X 术语表</a></li>
<li><a href="http://www.cocoachina.com/mac/20150122/10988.html" target="_blank" rel="noopener">了解iOS上的可执行文件和Mach-O格式</a></li>
<li><a href="http://oncenote.com/2015/06/01/How-App-Launch/" target="_blank" rel="noopener">由App的启动说起</a></li>
<li><a href="https://objccn.io/issue-6-3/" target="_blank" rel="noopener">Mach-O 可执行文件</a> </li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://chuquan.me/2018/01/21/browser-architecture-overview/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="包楚权">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/slamdunk.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="包楚权的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/21/browser-architecture-overview/" itemprop="url">现代浏览器工作原理（一）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-21T00:01:06+08:00">
                2018-01-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/计算机原理/" itemprop="url" rel="index">
                    <span itemprop="name">计算机原理</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="序"><a href="#序" class="headerlink" title="序"></a>序</h1><p>这些天在考虑选择什么主题在即将来临的公司技术分享会上进行分享。思来想去，也没找到什么比较好的主题。逆向？已经有人分享过了…框架？不是针对特定需求的框架，介绍起来感觉也没有太大的意义…</p>
<p>恍惚间，想起之前@展哥在调高考真题Hybrid页面时，似乎在前端代码方面遇到一些麻烦。于是，我就想到了UIWebView。就此进行思维发散，感觉可以介绍一下浏览器的工作原理。毕竟，iOS和前端同属于大客户端。对于iOS的同学，也算是对知识面的扩展吧。</p>
<p>于是，我查阅了一些与浏览器原理相关的资料。在这个过程中，找到很多优秀的资料。但是，大多数资料的组织结构，不是特别清晰。因此，我想借此机会，结合参考资料，来重新梳理一下浏览器的原理。由于浏览器的结构非常复杂，一篇文章想介绍清楚，真的太难。本文将使用总-分-总的形式，使用一系列文章来进行介绍。如有纰漏，欢迎纠正。</p>
<h1 id="浏览器历史"><a href="#浏览器历史" class="headerlink" title="浏览器历史"></a>浏览器历史</h1><p>1990年，<a href="https://zh.wikipedia.org/wiki/%E8%92%82%E5%A7%86%C2%B7%E4%BC%AF%E7%BA%B3%E6%96%AF-%E6%9D%8E" target="_blank" rel="noopener">蒂姆·伯纳斯·李</a>开发了第一个网页浏览器<a href="https://zh.wikipedia.org/wiki/WorldWideWeb" target="_blank" rel="noopener">WorldWideWeb</a>，后改名为<strong>Nexus</strong>。WorldWideWeb浏览器支持早期的HTML标记语言，功能比较简单，只能支持文本、简单的样式表、电影、声音、图片等资源的显示。</p>
<p>1993年，<a href="https://zh.wikipedia.org/wiki/%E9%A9%AC%E5%85%8B%C2%B7%E5%AE%89%E5%BE%B7%E6%A3%AE" target="_blank" rel="noopener">马克·安德森</a>领导的团开发了一个真正有影响力的浏览器<a href="https://zh.wikipedia.org/wiki/Mosaic" target="_blank" rel="noopener">Mosaic</a>，这就是后来世界上最流行的浏览器<a href="https://zh.wikipedia.org/wiki/Netscape_Navigator" target="_blank" rel="noopener">Netscape Navigator</a>。</p>
<p>1995年，微软推出了闻名于世的浏览器<a href="https://zh.wikipedia.org/wiki/Internet_Explorer" target="_blank" rel="noopener">Internet Explorer</a>。</p>
<p>1998年，Netscape公司开放Netscape Navigator源代码，成立了Mozilla基金会。</p>
<p>2003年，苹果公司发布了Safari浏览器。</p>
<p>2004年，Netscape公司发布了著名的开源浏览器<a href="https://zh.wikipedia.org/wiki/Firefox" target="_blank" rel="noopener">Mozilla Firefox</a></p>
<p>2005年，苹果公司开源了浏览器中的核心代码，基于此发起了一个新的开源项目WebKit（Safari浏览器的内核）。</p>
<p>2008年， Google公司已WebKit为内核，创建了一个新的浏览器项目<a href="https://zh.wikipedia.org/zh-hant/Chromium" target="_blank" rel="noopener">Chromium</a>。以Chromium为基础，谷歌发布了<a href="https://zh.wikipedia.org/wiki/Google_Chrome" target="_blank" rel="noopener">Chrome</a>浏览器。至于这两者的关系，可以简单地理解为：Chromium为实验版，具有众多新特性；Chrome为稳定版。</p>
<h1 id="浏览器特性"><a href="#浏览器特性" class="headerlink" title="浏览器特性"></a>浏览器特性</h1><p>现代浏览器的特性主要包含如下几部分：</p>
<ul>
<li><strong>网络</strong><br>  浏览器通过网络模块下载各种资源，如：HTML文档、JavaScript代码、样式表、图片、音频视频文件等。 网络模块是浏览器最重要的模块之一。</li>
<li><strong>资源管理</strong><br>  浏览器通过高效的管理机制来管理网络资源和本地资源。比如如何避免重复下载资源、缓存资源等。</li>
<li><strong>网页浏览</strong><br>  浏览器最核心的功能。浏览器通过网络下载资源，并从资源管理器获得资源，然后将其转化为可视化结果。</li>
<li><strong>多页面管理</strong><br>  浏览器支持多页面浏览，因此支持多页面同时加载。浏览器需要多页面管理机制来解决例如多页面的相互影响和安全等问题。</li>
<li><strong>插件和扩展</strong><br>  现代浏览器的重要特征。插件可以用来显示网页特定内容；扩展则是增加浏览器新功能的软件或压缩包。</li>
<li><strong>账户和同步</strong><br>  现代软件的普遍特性。浏览器将用户的浏览信息，例如历史记录、书签等信息同步到服务器，提供多系统下的统一体验。</li>
<li><strong>安全机制</strong><br>  现代软件的重要特性。浏览器的安全机制需要提供一个安全的浏览环境，例如：避免用户信息被窃取或破坏、防止浏览器被恶意代码攻破等。</li>
<li><strong>开发者工具</strong><br>  开发者工具是浏览器提供给网页开发者的工具，可以帮助审查HTML元素、调试JavaScript代码、改善网页性能等。</li>
</ul>
<h1 id="浏览器结构"><a href="#浏览器结构" class="headerlink" title="浏览器结构"></a>浏览器结构</h1><p>目前，常用的浏览器主要有：Chrome、IE（Edge）、Safari、Firefox等。不同的浏览器在结构方面虽然有所差异，但是整体的设计理念是相似的。因此，可以抽象得到如下图所示的参考结构：</p>
<div align="center"><img src="http://chuquan-public-r-001.oss-cn-shanghai.aliyuncs.com/blog-images/browser-architecture001.png" alt=""></div>

<p>浏览器的抽象分层结构图中将浏览器分成了以下8个子系统：</p>
<ul>
<li><strong>用户界面（User Interface）</strong><br>  用户界面主要包括工具栏、地址栏、前进/后退按钮、书签菜单、可视化页面加载进度、智能下载处理、首选项、打印等。除了浏览器主窗口显示请求的页面之外，其他显示的部分都属于用户界面。<br>  用户界面还可以与桌面环境集成，以提供浏览器会话管理或与其他桌面应用程序的通信。</li>
<li><strong>浏览器引擎（Browser Engine）</strong><br>  浏览器引擎是一个可嵌入的组件，其为渲染引擎提供高级接口。<br>  浏览器引擎可以加载一个给定的URI，并支持诸如：前进/后退/重新加载等浏览操作。<br>  浏览器引擎提供查看浏览会话的各个方面的挂钩，例如：当前页面加载进度、JavaScript alert。<br>  浏览器引擎还允许查询/修改渲染引擎设置。</li>
<li><strong>渲染引擎（Rendering Engine）</strong><br>  渲染引擎为指定的URI生成可视化的表示。<br>  渲染引擎能够显示HTML和XML文档，可选择CSS样式，以及嵌入式内容（如图片）。<br>  渲染引擎能够准确计算页面布局，可使用“回流”算法逐步调整页面元素的位置。<br>  渲染引擎内部包含HTML解析器。</li>
<li><strong>网络（Networking）</strong><br>  网络系统实现HTTP和FTP等文件传输协议。 网络系统可以在不同的字符集之间进行转换，为文件解析MIME媒体类型。 网络系统可以实现最近检索资源的缓存功能。</li>
<li><strong>JavaScript解释器（JavaScript Interpreter）</strong><br>  JavaScript解释器能够解释并执行嵌入在网页中的JavaScript（又称ECMAScript）代码。  为了安全起见，浏览器引擎或渲染引擎可能会禁用某些JavaScript功能，如弹出窗口的打开。</li>
<li><strong>XML解析器（XML Parser）</strong><br>  XML解析器可以将XML文档解析成文档对象模型（Document Object Model，DOM）树。 XML解析器是浏览器架构中复用最多的子系统之一，几乎所有的浏览器实现都利用现有的XML解析器，而不是从头开始创建自己的XML解析器。</li>
<li><strong>显示后端（Display Backend）</strong><br>  显示后端提供绘图和窗口原语，包括：用户界面控件集合、字体集合。</li>
<li><strong>数据持久层（Data Persistence）</strong><br>  数据持久层将与浏览会话相关联的各种数据存储在硬盘上。 这些数据可能是诸如：书签、工具栏设置等这样的高级数据，也可能是诸如：Cookie，安全证书、缓存等这样的低级数据。</li>
</ul>
<p>这里可能会产生一个疑问：功能相似的HTML解析器和XML解析器为什么前者划分在渲染引擎中，后者作为独立的系统？<br>原因：XML解析器对于系统来说，其功能并不是关键性的，但是从复用角度来说，XML解析器是一个通用的，可重用的组件，具有标准的，定义明确的接口。相比之下，HTML解析器通常与渲染引擎紧耦合。</p>
<h1 id="渲染引擎"><a href="#渲染引擎" class="headerlink" title="渲染引擎"></a>渲染引擎</h1><p>浏览器的组成模块众多，而渲染引擎则是浏览器中最重要的模块（渲染引擎有时候也被称为“浏览器内核”，这种说法并不严谨，不推荐使用）。目前，常见的渲染引擎有Trident、Gecko、WebKit等。下表所示为几种渲染引擎在不同浏览器中的应用：</p>
<table>
<thead>
<tr>
<th style="text-align:left">渲染引擎</th>
<th style="text-align:left">浏览器</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Trident</td>
<td style="text-align:left">IE、Edge</td>
</tr>
<tr>
<td style="text-align:left">Gecko</td>
<td style="text-align:left">Firefox</td>
</tr>
<tr>
<td style="text-align:left">WebKit</td>
<td style="text-align:left">Safari、Chromium/Chrome</td>
</tr>
</tbody>
</table>
<h2 id="渲染引擎工作流程"><a href="#渲染引擎工作流程" class="headerlink" title="渲染引擎工作流程"></a>渲染引擎工作流程</h2><p>如下图所示为渲染引擎的渲染流程示意图，其以HTML/JavaScript/CSS等文件作为输入，以可视化内容作为输出。</p>
<div align="center"><img src="http://chuquan-public-r-001.oss-cn-shanghai.aliyuncs.com/blog-images/browser-architecture002.png" alt=""></div>

<ol>
<li><p><strong>Parsing HTML to Construct DOM Tree</strong><br>渲染引擎使用HTML解析器（调用XML解析器）解析HTML（XML）文档，将各个HTML（XML）元素逐个转化成DOM节点，从而生成DOM树。<br>同时，渲染引擎使用CSS解析器解析外部CSS文件以及HTML（XML）元素中的样式规则。元素中带有视觉指令的样式规则将用于下一步，以创建另一个树结构：渲染树。  </p>
</li>
<li><p><strong>Render Tree construction</strong><br>渲染引擎使用第1步CSS解析器解析得到的样式规则，将其附着到DOM树上，从而构成渲染树。<br>渲染树包含多个带有视觉属性（如颜色和尺寸）的矩形。这些矩形的排列顺序就是它们将在屏幕上显示的顺序。</p>
</li>
<li><p><strong>Layout of Render Tree</strong><br>渲染树构建完毕之后，进入本阶段进行“布局”，也就是为每个节点分配一个应出现在屏幕上的确切坐标。</p>
</li>
<li><p><strong>Painting Render Tree</strong><br>渲染引擎将遍历渲染树，并调用显示后端将每个节点绘制出来。</p>
</li>
</ol>
<h2 id="渲染引擎组成模块"><a href="#渲染引擎组成模块" class="headerlink" title="渲染引擎组成模块"></a>渲染引擎组成模块</h2><p>下图所示为渲染引擎工作流程中各个步骤所对应的模块，其中第1步和第2步涉及到多个模块，并且耦合程度较高。这样的设计会为了达到更好的用户体验，渲染引擎尽快将内容显示在屏幕上。它不必等到整个HTML文档解析完毕之后，就可以开始渲染树构建和布局设置。在不断接收和处理来自网络的其余内容的同时，渲染引擎会将部分内容解析并显示出来。</p>
<div align="center"><img src="http://chuquan-public-r-001.oss-cn-shanghai.aliyuncs.com/blog-images/browser-architecture003.png" alt=""></div>

<p>从图中可以看出，渲染引擎主要包含（或调用）的模块有：</p>
<ul>
<li><strong>HTML（XML）解析器</strong><br>  解析HTML（XML）文档，主要作用是将HTML（XML）文档转换成DOM树。</li>
<li><strong>CSS解析器</strong><br>  将DOM中的各个元素对象进行计算，获取样式信息，用于渲染树的构建。</li>
<li><strong>JavaScript解释器</strong><br>  使用JavaScript可以修改网页的内容、CSS规则等。JavaScript解释器能够解释JavaScript代码，并通过DOM接口和CSSOM接口来修改网页内容、样式规则，从而改变渲染结果。</li>
<li><strong>布局</strong><br>  DOM创建之后，渲染引擎将其中的元素对象与样式规则进行结合，可以得到渲染树。布局则是针对渲染树，计算其各个元素的大小、位置等布局信息。</li>
<li><strong>绘图</strong><br>  使用图形库将布局计算后的渲染树绘制成可视化的图像结果。</li>
</ul>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>本文介绍了浏览器的主要特性以及抽象结构，并选择其中最为核心的渲染引擎进行了介绍。渲染引擎是浏览器中最为复杂的部件，后续将对渲染引擎中的各个模块依次进行介绍。</p>
<p>（完）</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li><a href="https://zh.wikipedia.org/wiki/%E7%BD%91%E9%A1%B5%E6%B5%8F%E8%A7%88%E5%99%A8" target="_blank" rel="noopener">Web Browser-Wikipedia</a></li>
<li>Adam Barth, Collin Jackson, Charles Reis, Google Chrome Team. The Security Architecture of the Chromium Browser.</li>
<li>Andre Campos, Bryan Lane, Neal Clark, Sunpreet Jassal, Stephen Hitchner. Conceptual Architecture of Firefox.</li>
<li>Alan Grosskurth and Michael Godfrey. A case study in architectural analysis: The evolution of the modern web browser.</li>
<li><a href="http://web.jobbole.com/84826/" target="_blank" rel="noopener">主流浏览器内核介绍（前端开发值得了解的浏览器内核历史）</a></li>
<li>朱永盛. 《WebKit技术内幕》.</li>
<li><a href="https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/" target="_blank" rel="noopener">浏览器的工作原理：新式网络浏览器幕后揭秘</a></li>
<li>Alan Grosskurth, Michael W.Godfrey. A Reference Architecture for Web Browsers.</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://chuquan.me/2018/01/02/2017-summary/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="包楚权">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/slamdunk.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="包楚权的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/02/2017-summary/" itemprop="url">2017年总结</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-02T00:21:20+08:00">
                2018-01-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/生活/" itemprop="url" rel="index">
                    <span itemprop="name">生活</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>这几天，脉脉上有一个年度总结的活动。2017年，我对自己的总结便是一个字——<strong>变</strong>。</p>
<div align="center"><img src="http://chuquan-public-r-001.oss-cn-shanghai.aliyuncs.com/blog-images/maimai-2017-summary.png?x-oss-process=image/resize,w_400" alt=""></div>

<h1 id="关于论文毕设"><a href="#关于论文毕设" class="headerlink" title="关于论文毕设"></a>关于论文毕设</h1><p>2017的上半年是我硕士生涯，也是我学生生涯的最后一个学期。这半年真的是一直处于焦虑中，毕业总是令人如鲠在喉。有人可能会问硕士毕业有这么难吗？如果我说我们是在毕业答辩前两个月才开的题你信吗？</p>
<p>关于毕业论文，我是经历过换题的。研二期间，一直在做碳纳米管计算机项目。然而，到了毕业选题的时候，才发现这个项目根本没有可深入研究的、与计算机体系结构相关的东西。不得已，只能换题。此时，恰逢2016年的10月，校招还在如火如荼地进行。而我已经没有心情继续找工作了。</p>
<p>2017年年初，@易老师给了我一个毕业选题的大方向——RISC-V &amp; TLB &amp; 安全。参考往年类似的毕业选题（如：@天一师兄、@翁东旭师兄的毕业论文），我大致规划出了毕业论文的框架。然而，往年论文的相关实验都是基于完整的项目平台，研究及评测环境相对来说都是比较完备的。我的毕业选题采用的实验平台则是基于RISC-V的开源处理器生成器——Rocket Chip Generator，该平台是2014年由UCB推出的，其研究及评测环境都还不完善，不足以提供标准且完整的论述、验证、评估的能力。</p>
<p>为了让论文能有更多的干货，我还去探索了TLB/MMU在安全方面研究的可能性。不过，这个想法在后来的预开题中被否决了。好在，预开题时，@佟老师给了我很多的建设性的意见，比如：研究Generator自动化生成硬件的原理、Chisel原理等。我能够在6月份顺利毕业，真的要感谢我的导师@佟老师、@易老师，在毕设期间予以我的帮助和建议。</p>
<h1 id="关于科研项目"><a href="#关于科研项目" class="headerlink" title="关于科研项目"></a>关于科研项目</h1><p>2月底春季的开学阶段，我提前了一周回了学校。因为，在做毕业的同时，我还要和物理电子所的同学对接碳纳米管项目。为了能让项目顺利结题，春节前后和@海涛师兄、@司佳师姐、@东维师弟一起忙活了一段时间。项目最后顺利结题，也算是了却了一桩心事。在4月份左右，@彭老师、@程老大又来了一次巨头会议，要在北大120周年献礼。也就是说，碳纳米管项目继续进行。当然，我知道自己不能继续跟进，便把工作交接了@李宁师妹和@东维师弟了。希望明年的五四，能给大家带来一个惊喜。</p>
<h1 id="关于毕业答辩"><a href="#关于毕业答辩" class="headerlink" title="关于毕业答辩"></a>关于毕业答辩</h1><p>3月底，实验室进行了开题答辩会。这个开题时间放眼整个北大，也算是晚的了。不知道@老大作何感想，可能真的是日理万机吧。不过，从开题答辩会上老大的表述，能看出@老大对于我们这一届还是抱有歉意，希望我们都能顺利毕业。</p>
<p>6月2日，毕业答辩会如期进行。答辩会上有校外专家，当我们有遇到答不上的问题或被专家刁难的时候，@老大能够及时救场，果然护犊子！手动点赞！结果是显而易见的，所有人都顺利毕业。</p>
<p>答辩过后，和@小威威、@大帅、@赵璐、@昊泽去了南门翅客吃了烧烤，果然是前所未有的轻松。</p>
<h1 id="关于毕业旅行"><a href="#关于毕业旅行" class="headerlink" title="关于毕业旅行"></a>关于毕业旅行</h1><p>6月3日是我们的发出时间，一个月前订机票时也是非常忐忑，毕竟答辩时间是6月2日，就怕答辩时间更改。关于毕业旅行的详细内容，可以看<a href="http://chuquan.me/2017/06/16/tailand/">这里</a>。</p>
<h1 id="关于毕业典礼"><a href="#关于毕业典礼" class="headerlink" title="关于毕业典礼"></a>关于毕业典礼</h1><p>毕业旅行回来，能感受到浓厚的离别气息。拍毕业照、毕业典礼、谢师宴…从今往后，同窗同门都要各奔东西。</p>
<h1 id="关于工作"><a href="#关于工作" class="headerlink" title="关于工作"></a>关于工作</h1><p>校招时，我投递的岗位是前端开发工程师，后来HR跟我沟通有没有转岗iOS开发工程师的意愿。在考虑了几天后，我选择了转岗。我当时的想法是这样的：</p>
<ul>
<li>前端的门槛比较低，从业人员比较很多，想真正脱颖而出还是比较困难的，感觉硕士毕业从事前端的优势并不大。</li>
<li>前端的技术更新迭代速度太快，没有一个统一的行业标准，不同的公司可能采用完全不同的技术栈。所以，前端岗需要不断地学习，一旦松懈，可能就会被淘汰，压力比较大。</li>
<li>程序员都知道所谓的“程序员鄙视链”，前端是处于“鄙视链”的下游的。虽然前端已经今非昔比了，但是总的来说，职业天花板比较低。</li>
</ul>
<p>出于这些考虑，我选择了转岗。</p>
<p>7月初，办完了毕业手续，我和@撸神便搬家到了我们的整租房。在学校呆了20年，离开时真的很不习惯。</p>
<p>7月10日，在紧张和期待中办理了入职手续。期间，遇到了校友@家骏、@仲雪。中午，我的mentor@展哥接待了我，然后便组织大家在云海肴来了一波TB。</p>
<p>@展哥已经有7年的工作经验了，作为小猿搜题iOS端负责人，他的技术能力的确是很强的。作为mentor，他也是尽心尽力，真的非常nice。相比于我在某度的mentor，真是不知道高到哪里去了，无论是技术能力，还是个人修养。然而，没想到@展哥年后要离职，真的有点不舍啊。</p>
<p>我工位的右边是@展哥，左边是@琳洁——一位iOS程序媛。她虽然话不多，但是只要有问题，她都能悉心指导我。而且做事特别细致，从code review就能看出来。</p>
<p>我的leader@邱瑞，也是我的校友师兄。为人非常nice，说话语气很平和，平时分配任务、交谈时完全没有一种上下级的感觉。对于产品需求的评估、事务的处理都是非常到位。</p>
<p>有人说：想要在职场上快速成长，可以尝试学习你领导的做事方式。我个人非常赞同这种观点，希望新的一年，我能够像@展哥、@邱瑞、@琳洁他们一样做人做事。</p>
<h1 id="关于技术"><a href="#关于技术" class="headerlink" title="关于技术"></a>关于技术</h1><p>上半年写的代码基本都是服务于毕业设计，都是与硬件相关。下半年学的都是工程相关：</p>
<ul>
<li>在编程语言方面，学习了两门新的语言：Objective-C、Swift。</li>
<li>在版本管理方面，能够熟练使用git的各种常用命令。</li>
<li>在项目管理方面，了解了公司的项目管理流程以及敏捷开发模式，自己还搭建了Gerrit代码审核服务器。</li>
</ul>
<h1 id="关于阅读"><a href="#关于阅读" class="headerlink" title="关于阅读"></a>关于阅读</h1><p>2017年1月1日，我计划开始记录自己的阅读轨迹，其实主要原因是希望能够督促自己保持阅读（阅读轨迹<a href="http://chuquan.me/2017/01/05/read-books/">在这里</a>）。2017年总共阅读了不到10本书。希望新的一年，在阅读时能够有更多的自我思考，尽可能产出一些读书笔记。虽然，我读书的时候喜欢使用有道云来做笔记，但是缺少整理、总结和发布。</p>
<h1 id="展望"><a href="#展望" class="headerlink" title="展望"></a>展望</h1><p>对于公司来说，都会有年度目标，这样公司才能够健康成长。对于个人也是一样，给自己定一个目标，希望能够激励自己成长。2018年伊始，我也想给自己定一些小目标。</p>
<ul>
<li>至少看完两个iOS开源框架源代码（向大神靠拢）</li>
<li>至少看12本书，非工具类的书，需要有读书笔记（向@巧叔学习）</li>
<li>在技术方面，能够hold住产品经理提出来的所有需求（向@琳洁@展哥学习</li>
<li>在业务方面，了解小猿搜题的所有业务代码（向@邱瑞@琳洁@展哥学习）</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://chuquan.me/2017/12/27/ssh-protocol-practice/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="包楚权">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/slamdunk.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="包楚权的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/27/ssh-protocol-practice/" itemprop="url">SSH 协议实践</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-27T01:09:02+08:00">
                2017-12-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/软件/" itemprop="url" rel="index">
                    <span itemprop="name">软件</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="一、SSH概述"><a href="#一、SSH概述" class="headerlink" title="一、SSH概述"></a>一、SSH概述</h1><p>类似于HTTP，SSH（Secure Shell）是一种加密的网络传输协议，常用于加密远程登录。</p>
<p>1995年，芬兰赫尔辛基理工大学的塔图·于勒宁因为发现自己学校存在嗅探密码的网络攻击，设计了一套保护信息传输的程序，即Secure Shell（简称SSH），其目标是取代先前的<code>rlogin</code>、<code>Telnet</code>、<code>FTP</code>、<code>rsh</code>等安全性不足的协议。如今，最为广泛使用的<code>OpenSSH</code>便是SSH协议的一种免费开源实现。</p>
<h1 id="二、基本原理"><a href="#二、基本原理" class="headerlink" title="二、基本原理"></a>二、基本原理</h1><p>SSH使用非对称加密算法实现身份验证，即采用<strong>公钥-私钥对</strong>来进行加密网络连接。私钥由用户（本地主机）自行保管，公钥由远程主机（如：服务器）保管。</p>
<h1 id="三、应用实践"><a href="#三、应用实践" class="headerlink" title="三、应用实践"></a>三、应用实践</h1><p>下面使用<code>OpenSSH</code>进行具体实践。</p>
<h2 id="1-SSH协议语法格式"><a href="#1-SSH协议语法格式" class="headerlink" title="1. SSH协议语法格式"></a>1. SSH协议语法格式</h2><p>SSH主要用于远程登录，如下所示为SSH协议的语法格式。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh [&lt;username&gt;@]&lt;server&gt;[:&lt;port&gt;]</span><br></pre></td></tr></table></figure></p>
<h2 id="2-关于SSH公钥认证"><a href="#2-关于SSH公钥认证" class="headerlink" title="2. 关于SSH公钥认证"></a>2. 关于SSH公钥认证</h2><p>为实现公钥认证，作为认证的客户端一方需要拥有两个文件，即<strong>公钥-私钥对</strong>。一般公钥-私钥对文件创建在用户的主目录下的<code>.ssh</code>目录中。如果用户主目录下不存在<code>.ssh</code>目录，说明SSH公钥-私钥对尚未创建。</p>
<h3 id="（1）创建公钥-私钥对"><a href="#（1）创建公钥-私钥对" class="headerlink" title="（1）创建公钥-私钥对"></a>（1）创建公钥-私钥对</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-keygen</span><br></pre></td></tr></table></figure>
<p>该命令会在用户主目录下创建<code>.ssh</code>目录，并在其中创建两个文件：</p>
<ul>
<li><code>id_rsa</code>：私钥文件。是基于RSA算法创建的。</li>
<li><code>id_rsa.pub</code>：公钥文件。</li>
</ul>
<h3 id="（2）分发公钥"><a href="#（2）分发公钥" class="headerlink" title="（2）分发公钥"></a>（2）分发公钥</h3><p>创建了公钥-私钥对后，需要将公钥交给远程主机保管，这样才能在之后的登录实现无口令登录。如下命令，会将<code>.ssh</code>目录下指定的公钥文件拷贝至远程服务器。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-copy-id -i .ssh/id_rsa.pub &lt;user&gt;@&lt;server&gt;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>该命令会提示输入用户user在server上的SSH登录口令  </li>
<li>此命令执行成功后，再以user用户用ssh命令登录server远程主机时，不必输入口令可直接登录</li>
<li>该命令实际上是<code>.ssh/id_rsa.pub</code>公钥文件拷贝到远程主机server的user主目录下的<code>.ssh/authorized_keys</code>文件中，内容类似如下：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDHJu4oVxIbLS2LBH5wI7htvDxuIMZ5IFUaZjbWI8z...M4yGEWcr7OVPdQa4DIEbrrl8MzsAZ baochuquan@baochuquandeMacBoo    k-Pro.local</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="3-关于SSH主机别名"><a href="#3-关于SSH主机别名" class="headerlink" title="3. 关于SSH主机别名"></a>3. 关于SSH主机别名</h2><p>在实际应用中，有时需要使用多套公钥/私钥对。然而，上述创建公钥-私钥对的命令只会生成默认名为<code>id_rsa</code>的密钥对。</p>
<h3 id="（1）创建公钥-私钥对-1"><a href="#（1）创建公钥-私钥对-1" class="headerlink" title="（1）创建公钥-私钥对"></a>（1）创建公钥-私钥对</h3><p>为了创建不同的公钥/私钥对，在使用<code>ssh-keygen</code>命令时就需要通过<code>-f</code>参数指定不同的私钥名称。用法如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-keygen -f ~/.ssh/&lt;filename&gt;</span><br></pre></td></tr></table></figure></p>
<p>命令会在<code>.ssh/</code>目录下创建指定的公钥/私钥对：文件<code>&lt;filename&gt;</code>是私钥，文件<code>&lt;filename&gt;.pub</code>是公钥。</p>
<h3 id="（2）分发公钥-1"><a href="#（2）分发公钥-1" class="headerlink" title="（2）分发公钥"></a>（2）分发公钥</h3><p>将新生成的公钥添加到远程主机登录用户主目录下的<code>.ssh/authorized_keys</code>文件中，就可以使用新创建的公钥建立到远程主机<server>的<user>账户的无口令登录：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-copy-id -i .ssh/&lt;filename&gt;.pub &lt;user&gt;@&lt;server&gt;</span><br></pre></td></tr></table></figure></user></server></p>
<p>在有多个公钥/私钥对时，默认使用<code>~/.ssh/id_rsa.pub</code>。那么如何使用新建的公钥连接server呢？</p>
<h3 id="（3）管理本地私钥"><a href="#（3）管理本地私钥" class="headerlink" title="（3）管理本地私钥"></a>（3）管理本地私钥</h3><p>SSH的客户端配置文件<code>~/.ssh/config</code>可以通过创建主机别名，连接主机时选择用指定的私钥。例如<code>/.ssh/config</code>文件中的下列配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 使用默认的id_rsa私钥</span><br><span class="line">Host gerrit.zhenguanyu.com</span><br><span class="line">    Hostname gerrit.zhenguanyu.com</span><br><span class="line">    Port 29418</span><br><span class="line">    User baocq</span><br><span class="line">    </span><br><span class="line"># 使用指定的chuquan01私钥</span><br><span class="line">Host chuquan</span><br><span class="line">  user root</span><br><span class="line">  hostname 115.28.167.128</span><br><span class="line">  port 22</span><br><span class="line">  identityfile ~/.ssh/chuquan01</span><br><span class="line">      </span><br><span class="line"># 使用指定的gerrit01私钥</span><br><span class="line">Host gerrit</span><br><span class="line">  user gerrit</span><br><span class="line">  hostname 115.28.167.128</span><br><span class="line">  port 22</span><br><span class="line">  identityfile ~/.ssh/gerrit01</span><br></pre></td></tr></table></figure></p>
<h3 id="（4）无口令远程登录"><a href="#（4）无口令远程登录" class="headerlink" title="（4）无口令远程登录"></a>（4）无口令远程登录</h3><p>执行下面的SSH登录命令，即可登录Host为<code>chuquan</code>的主机：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh chuquan</span><br></pre></td></tr></table></figure></p>
<p>（完）</p>
<p><strong>参考</strong><br>[1] <a href="https://zh.wikipedia.org/wiki/Secure_Shell" target="_blank" rel="noopener">Secure Shell</a><br>[2] <a href="http://www.ruanyifeng.com/blog/2011/12/ssh_remote_login.html" target="_blank" rel="noopener">SSH原理与运用（一）：远程登录</a><br>[3] <a href="http://www.ruanyifeng.com/blog/2011/12/ssh_port_forwarding.html" target="_blank" rel="noopener">SSH原理与运用（二）：远程操作与端口转发</a><br>[4] 《Git权威指南》，蒋鑫</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://chuquan.me/2017/12/12/ubuntu-gerrit-apache/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="包楚权">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/slamdunk.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="包楚权的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/12/ubuntu-gerrit-apache/" itemprop="url">Ubuntu + Gerrit + Apache 搭建代码审核服务器</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-12T23:23:33+08:00">
                2017-12-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/软件/" itemprop="url" rel="index">
                    <span itemprop="name">软件</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>我们公司采用Gerrit作为代码审核服务器并结合JIRA、Jenkins等开源工具，组成了一个完整项目管理平台。某天，我兴致来了，也想在自己的服务器上搭建一个Gerrit。于是，便有了以下内容…</p>
<h1 id="一、Gerrit介绍"><a href="#一、Gerrit介绍" class="headerlink" title="一、Gerrit介绍"></a>一、Gerrit介绍</h1><p>Gerrit的目的是提供一个轻量级的框架来review每一个commit，review通过之后，commit会被合入代码库。</p>
<p>Gerrit是一个中间区域，可以看到提交至Gerrit上的代码相对于服务器代码仓库中代码的差异，从而便于检查代码的改动。Gerrit也是整个代码review的推动者。</p>
<p>任何拥有多个成员的团队都应该有一个中央代码仓库。 Git在理论上可以在没有这样的中心位置的情况下工作，但实际上通常有一个中央仓库库作为项目实际内容的权威副本。 开发者从该中央仓库fetch和push</p>
<div align="center"><img src="http://chuquan-public-r-001.oss-cn-shanghai.aliyuncs.com/daily-images/central-source-repository.png?x-oss-process=image/resize,w_570" alt=""></div>

<p>Gerrit被部署在上图的中央仓库的位置，并增加一个新的概念：<strong>a store of pending changes（未决的修改）</strong>。每个人仍然可以从中央仓库fetch，但是push操作则有所变化，push操作会直接push到中央仓库，而是push到了<strong>pending changes location</strong>，以供review。只有在commit通过了review之后，才会被submit到中央仓库。如下图所示。</p>
<div align="center"><img src="http://chuquan-public-r-001.oss-cn-shanghai.aliyuncs.com/daily-images/gerrit-in-place-of-central-repository.png?x-oss-process=image/resize,w_570" alt=""></div>

<p>Gerrit具有强大的访问控制模型。用户可以被授予访问权限，绕过review，直接推送到中央仓库。Gerrit甚至可以在没有代码review的情况下使用，只用于托管仓库和访问控制。</p>
<h1 id="二、应用场景"><a href="#二、应用场景" class="headerlink" title="二、应用场景"></a>二、应用场景</h1><p>在安装gerrit之前，我使用<code>node</code>在服务器上部署了一个站点，也就是本博客，其占用了<code>80</code>端口。</p>
<p>在安装gerrit之后，我的服务器又将多出一个站点，用户该如何访问？我又该如何部署呢？这时候，我们就需要了解一下<code>反向代理</code>和<code>端口转发</code>了。</p>
<h2 id="1-正向代理与反向代理"><a href="#1-正向代理与反向代理" class="headerlink" title="1. 正向代理与反向代理"></a>1. 正向代理与反向代理</h2><p>如下所示为正向代理和反向代理的示意图。一般来说，我们会把正向代理是与客户端划为一体，把反向代理和服务器划为一体。</p>
<div align="center"><img src="http://chuquan-public-r-001.oss-cn-shanghai.aliyuncs.com/blog-images/proxy-both.png" alt=""></div>

<p>此时，重新思考一下我们的应用场景：博客是一个web服务器，gerrit是一个web服务器，apache作为反向代理，这样就可以满足我们的需求了。</p>
<p>那么反向代理到底是如何做到的呢？答案就是<code>端口转发</code>。</p>
<p>我们知道在浏览器输入网址后，它会在解析后的IP地址之后加上一个默认的端口号<code>80</code>。所以，我们访问<code>chuquan.me</code>时就不需要输入完整的地址<code>chuquan.me:80</code>了。正因为如此，绝大多数服务器软件（包括apache）的默认监听端口也是<code>80</code>。</p>
<p>在安装了apache之后，<code>80</code>端口被apache占用了。因此，gerrit和博客都不能使用<code>80</code>端口了。这时候，我们需要给这两个站点配置使用其他的端口号，如：gerrit的HTTP协议使用<code>8081</code>端口，博客使用<code>8082</code>端口。它们与apache之间使用<code>端口转发</code>来实现<code>反向代理</code>。</p>
<div align="center"><img src="http://chuquan-public-r-001.oss-cn-shanghai.aliyuncs.com/blog-images/apache-gerrit-blog.png" alt=""></div>

<h1 id="三、开发环境"><a href="#三、开发环境" class="headerlink" title="三、开发环境"></a>三、开发环境</h1><ul>
<li>Ubuntu 14.04.5 LTS</li>
<li>Java 1.8.0_151</li>
<li>Git 1.9.1</li>
<li>Apache/2.4.7 </li>
</ul>
<h1 id="四、安装Gerrit"><a href="#四、安装Gerrit" class="headerlink" title="四、安装Gerrit"></a>四、安装Gerrit</h1><h2 id="1-新建专用用户"><a href="#1-新建专用用户" class="headerlink" title="1. 新建专用用户"></a>1. 新建专用用户</h2><p>新建一个用户来专门管理Gerrit相关内容。在root用户下新建一个gerrit用户。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ adduser gerrit</span><br><span class="line">$ su gerrit</span><br></pre></td></tr></table></figure></p>
<h2 id="2-下载Gerrit安装包"><a href="#2-下载Gerrit安装包" class="headerlink" title="2. 下载Gerrit安装包"></a>2. 下载Gerrit安装包</h2><p>Gerrit下载地址：<a href="https://www.gerritcodereview.com/releases/2.14.md" target="_blank" rel="noopener">https://www.gerritcodereview.com/releases/2.14.md</a></p>
<p>我安装的Gerrit版本是2.14.6。在Linux环境下使用<code>wget</code>进行下载，最终得到一个<code>war</code>包，位于<code>/home/gerrit/</code>目录下。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ wget https://gerrit-releases.storage.googleapis.com/gerrit-2.14.6.war</span><br></pre></td></tr></table></figure></p>
<h2 id="3-安装Gerrit"><a href="#3-安装Gerrit" class="headerlink" title="3. 安装Gerrit"></a>3. 安装Gerrit</h2><p>在<code>/home/gerrit/</code>目录下，进行安装：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar gerrit-2.14.6.war init -d review_site</span><br></pre></td></tr></table></figure></p>
<p>上述命令会在当前目录下创建一个<code>review_site</code>目录。接下来就开始进行对话式安装，我们可以直接回车，表示采用默认安装选项。之后还可以通过配置文件进行详细配置。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">*** Gerrit Code Review 2.14.6</span><br><span class="line">***</span><br><span class="line">*** Git Repositories  </span><br><span class="line">***  </span><br><span class="line">Location of Git repositories   [git]:   </span><br><span class="line">*** SQL Database  </span><br><span class="line">***  </span><br><span class="line">Database server type           [h2]:   </span><br><span class="line">*** User Authentication  </span><br><span class="line">***  </span><br><span class="line">Authentication method          [OPENID/?]: http  </span><br><span class="line">Get username from custom HTTP header [y/N]?  </span><br><span class="line">SSO logout URL                 :  </span><br><span class="line">*** Email Delivery  </span><br><span class="line">***  </span><br><span class="line">SMTP server hostname           [localhost]:  </span><br><span class="line">SMTP server port               [(default)]:  </span><br><span class="line">SMTP encryption                [NONE/?]:  </span><br><span class="line">SMTP username                  :  </span><br><span class="line">*** Container Process  </span><br><span class="line">***  </span><br><span class="line">Run as                         [gerrit]:  </span><br><span class="line">Java runtime                   [/usr/lib/jvm/java-7-openjdk-amd64/jre]:  </span><br><span class="line">Copy gerrit-2.13.4.war to /home/gerrit/review/bin/gerrit.war [Y/n]?  </span><br><span class="line">Copying gerrit-2.13.4.war to /home/gerrit/review/bin/gerrit.war  </span><br><span class="line">*** SSH Daemon  </span><br><span class="line">***  </span><br><span class="line">Listen on address              [*]:  </span><br><span class="line">Listen on port                 [29418]:  </span><br><span class="line">*** HTTP Daemon  </span><br><span class="line">***  </span><br><span class="line">Behind reverse proxy           [y/N]?   </span><br><span class="line">Proxy uses SSL (https://)      [y/N]?  </span><br><span class="line">Subdirectory on proxy server   [/]:  </span><br><span class="line">Listen on address              [*]:  </span><br><span class="line">Listen on port                 [8080]:</span><br><span class="line">*** Plugins  </span><br><span class="line">***  </span><br><span class="line">Installing plugins.  </span><br><span class="line">Install plugin download-commands version v2.11 [y/N]?  </span><br><span class="line">Install plugin reviewnotes version v2.11 [y/N]?  </span><br><span class="line">Install plugin singleusergroup version v2.11 [y/N]?  </span><br><span class="line">Install plugin replication version v2.11 [y/N]?  </span><br><span class="line">Install plugin commit-message-length-validator version v2.11 [y/N]?  </span><br><span class="line">Initializing plugins.  </span><br><span class="line">No plugins found with init steps.  </span><br><span class="line">Initialized /home/gerrit/review_site</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>安装完毕，Gerrit会自动启动，不过我们大概率会启动失败，因为默认的配置并不一定与你当前的环境相匹配。不过，没关系，我们可以根据系统环境对gerrit进行配置。</p>
<h2 id="4-Gerrit配置"><a href="#4-Gerrit配置" class="headerlink" title="4. Gerrit配置"></a>4. Gerrit配置</h2><p>Gerrit安装完成后，会在<code>review_site</code>目录下生成多个目录。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ ll review_site</span><br><span class="line">./</span><br><span class="line">../</span><br><span class="line">bin/</span><br><span class="line">cache/</span><br><span class="line">data/</span><br><span class="line">db/</span><br><span class="line">etc/</span><br><span class="line">git/</span><br><span class="line">index/</span><br><span class="line">lib/</span><br><span class="line">logs/</span><br><span class="line">plugins/</span><br><span class="line">static/</span><br><span class="line">tmp/</span><br></pre></td></tr></table></figure></p>
<p>其中<code>etc/</code>目录下存放着gerrit的配置文件<code>gerrit.config</code>，其中已有的内容是根据安装时的选择生成的。我们可以编辑<code>gerrit.config</code>来进行配置更改。其中<code>115.28.168.118</code>是服务器的公网IP地址。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[gerrit]</span><br><span class="line">        basePath = git</span><br><span class="line">        serverId = 084efaf9-3bf6-401c-a4b1-8778c998bde2</span><br><span class="line">        canonicalWebUrl = http://115.28.168.118 # 指定web访问Gerrit的网址或IP地址</span><br><span class="line">[database]</span><br><span class="line">        type = h2</span><br><span class="line">        database = /home/gerrit/review_site/db/ReviewDB</span><br><span class="line">[index]</span><br><span class="line">        type = LUCENE</span><br><span class="line">[auth]</span><br><span class="line">        type = HTTP # 默认是OPENID，改成HTTP后，才能通过浏览器进行访问</span><br><span class="line">[receive]</span><br><span class="line">        enableSignedPush = true</span><br><span class="line">[sendemail]</span><br><span class="line">        smtpServer = localhost</span><br><span class="line">[container]</span><br><span class="line">        user = gerrit</span><br><span class="line">        javaHome = /usr/lib/jvm/java-8-oracle/jre</span><br><span class="line">[sshd]</span><br><span class="line">        listenAddress = *:29418</span><br><span class="line">[httpd]</span><br><span class="line">        listenUrl = proxy-http://115.28.168.118:8081/ # HTTP代理地址及端口，这里我们配置成8081</span><br><span class="line">[cache]</span><br><span class="line">        directory = cache</span><br></pre></td></tr></table></figure></p>
<h1 id="四、配置Apache"><a href="#四、配置Apache" class="headerlink" title="四、配置Apache"></a>四、配置Apache</h1><p>不同系统以及不同版本的Apache的配置文件可能会不一样，无外乎两种：<code>httpd.conf</code>、<code>apache2.conf</code>。本环境的配置文件是<code>apache2.conf</code>。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd /etc/apache2/</span><br><span class="line">$ vim apache2.conf</span><br></pre></td></tr></table></figure></p>
<p>在配置文件的末尾添加apache的端口转发配置。如下所示<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"># Blog相关配置</span><br><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">	ServerName www.chuquan.me       # 用于Apache过滤检测的域名</span><br><span class="line">	ServerAlias chuquan.me</span><br><span class="line">    ProxyPass / http://115.28.168.118:8082/     # Blog正向代理转发的端口</span><br><span class="line">    ProxyPassReverse / http://localhost:8082/   # Blog反向代理转发的端口</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"># Gerrit相关配置</span><br><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">    ServerName gerrit.chuquan.me    # 用户Apache过滤检测的域名    </span><br><span class="line">    ProxyRequests Off</span><br><span class="line">    ProxyVia Off</span><br><span class="line">    ProxyPreserveHost On</span><br><span class="line">    &lt;Proxy *&gt;</span><br><span class="line">          Order deny,allow</span><br><span class="line">          Allow from all</span><br><span class="line">    &lt;/Proxy&gt;</span><br><span class="line">    &lt;Location /login/&gt;</span><br><span class="line">        AuthType Basic</span><br><span class="line">        AuthName &quot;Gerrit Code Review&quot;</span><br><span class="line">        Require valid-user</span><br><span class="line">        AuthBasicProvider file</span><br><span class="line">        AuthUserFile /home/gerrit/review_site/etc/passwords</span><br><span class="line">    &lt;/Location&gt;</span><br><span class="line">    AllowEncodedSlashes On</span><br><span class="line">    ProxyPass / http://115.28.168.118:8081/         # Gerrit正向代理转发的端口</span><br><span class="line">    ProxyPassReverse / http://115.28.168.118:8081/  # Gerrit反向代理转发端口，应该与ProxyPass一致</span><br><span class="line">&lt;/VirtualHost&gt;</span><br></pre></td></tr></table></figure></p>
<h1 id="五、服务重启"><a href="#五、服务重启" class="headerlink" title="五、服务重启"></a>五、服务重启</h1><p>Apache和Gerrit配置（当然也包括blog的端口）完之后，我们需要重启服务，包括apache、gerrit，其重启命令分别如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ /etc/init.d/apache2 restart</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd /home/gerrit/</span><br><span class="line">$ ./bin/gerrit.sh restart</span><br></pre></td></tr></table></figure>
<h2 id="1-Gerrit启动失败"><a href="#1-Gerrit启动失败" class="headerlink" title="1. Gerrit启动失败"></a>1. Gerrit启动失败</h2><p>在执行重启Gerrit的命令后，shell很可能会出现如下的信息：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Starting Gerrit Code Review: FAILED</span><br></pre></td></tr></table></figure></p>
<p>我在安装过程中页出现了这个问题，于是，我通过在<code>./bin/gerrit.sh</code>脚本中的首行添加了一个<code>-x</code>选项，以打印脚本执行的相关信息。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh -x</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>然后再执行该脚本，发现打印信息是一组循环信息。其中，当<code>TIMEOUT</code>的值递减至0时，启动失败。  </p>
<p>经过调研发现：  </p>
<blockquote>
<p>Gerrit启动慢是因为java程序启动慢，导致Gerrit启动非常慢，大概需要10分钟左右，而默认的超时时间（TIMEOUT）是90秒，导致一直提示“Starting Gerrit Code Review: FAILEDStarting Gerrit Code Review: FAILED”。对此有如下两种解决方案。</p>
</blockquote>
<p>第一种解决方案是：修改java的<code>java.security</code>文件。首先，根据<code>gerrit.config</code>中配置<code>javaHome = /user/lib/jvm/java-8-oracle/jre</code>，找到并进入该目录，然后再进入<code>lib/security/</code>目录，修改<code>java.security</code>文件。将<code>securerandom.source=file:/dev/random</code>改为<code>securerandom.source=file:/dev/urandom</code>。由此，解决gerrit启动慢的问题。</p>
<p>第二种解决方案是：在gerrit.conf文件中的<code>[container]</code>字段下增加`startupTimeout = 900。</p>
<h2 id="2-反向代理异常"><a href="#2-反向代理异常" class="headerlink" title="2. 反向代理异常"></a>2. 反向代理异常</h2><p>当我们配置结束并重启之后，在浏览器中访问很有可能会得到如下的页面：<br><img src="http://chuquan-public-r-001.oss-cn-shanghai.aliyuncs.com/blog-images/gerrit-configure-error.png" alt=""></p>
<p>这个页面在安装过程中，出现次数不下于10次。主要是两种情况，一种是Gerrit配置文件和Apache配置文件可能配置有误。另一种情况是配置没有生效，需要多试试重启。</p>
<h2 id="3-创建第一个Gerrit账户"><a href="#3-创建第一个Gerrit账户" class="headerlink" title="3. 创建第一个Gerrit账户"></a>3. 创建第一个Gerrit账户</h2><p>当所有问题解决完之后，通过浏览器访问Gerrit，将不会出现上面的Error界面，而是会弹出输入对话框，需要你填写账户和密码。</p>
<p>这时候，我们需要为Gerrit创建一个账户，默认第一个创建的账户是管理员。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ touch /home/gerrit/review_site/etc/passwords</span><br><span class="line">$ htpasswd /home/gerrit/review_site/etc/passwords &quot;admin&quot;</span><br><span class="line">New password:</span><br><span class="line">Re-type new password:</span><br><span class="line">Adding password for user root</span><br></pre></td></tr></table></figure></p>
<p>重启服务后，再用浏览器打开，登录后就出现久违的界面了！</p>
<p>（完）</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://chuquan.me/2017/10/10/git-rebase-merge/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="包楚权">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/slamdunk.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="包楚权的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/10/git-rebase-merge/" itemprop="url">Git rebase与merge的区别</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-10T14:49:03+08:00">
                2017-10-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/软件/" itemprop="url" rel="index">
                    <span itemprop="name">软件</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Git场景"><a href="#Git场景" class="headerlink" title="Git场景"></a>Git场景</h1><p>在基于Git版本控制的团队协作开发中，当同伴先于自己将新的提交push到远程分支上时，如果要想将自己新的提交push的远程分支，则需要先执行<code>git pull</code>来获取同伴的提交，如果有冲突则先处理完冲突，然后才能将自己的提交push到远程分支。这种情形是非常常见的。  </p>
<p>然而执行<code>git pull</code>，在默认情况下，如果远程分支与本地分支的提交线图有分叉（即不是<code>fast-forward</code>，如上述这种情形），git会执行一次merge操作（即相当于执行了<code>git pull --merge</code>），而这会产生一次没有意义的提交记录。久而久之，项目的提交线图会非常混乱，其中会有很多由merge生成的无意义提交。</p>
<h1 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h1><p>为了避免这种情况的出现，在将提交push到远程分支之前，我们一般会执行如下命令：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git pull --rebase</span><br></pre></td></tr></table></figure></p>
<p>通过上述命令，Git会采用rebase策略来代替默认的merge策略。从而避免生成无意义的提交。</p>
<h1 id="分析对比"><a href="#分析对比" class="headerlink" title="分析对比"></a>分析对比</h1><p>这时候，我们可能就会想：既然merge操作会生成无意义的提交，那它是不是没有什么价值了呢？是不是任何场景下都应该使用rebase操作？  </p>
<p>所以，我们对rebase和merge进行分析和对比。了解清楚了两者的区别，我们才能更好地运用这两个策略。</p>
<h2 id="场景设想"><a href="#场景设想" class="headerlink" title="场景设想"></a>场景设想</h2><p>假设在执行pull之前的提交线图如下所示：</p>
<div align="center"><img src="http://chuquan-public-r-001.oss-cn-shanghai.aliyuncs.com/daily-images/git-rebase-merge-example.png" alt=""></div>

<h2 id="Merge操作"><a href="#Merge操作" class="headerlink" title="Merge操作"></a>Merge操作</h2><p>如果执行<code>git pull</code>（git默认会执行<code>git pull --merge</code>），提交线图会变成如下所示：</p>
<div align="center"><img src="http://chuquan-public-r-001.oss-cn-shanghai.aliyuncs.com/daily-images/git-rebase-merge-example-merge.png" alt=""></div>

<p><strong>分析</strong><br>提交线图中多出了一个没有必要的提交<code>H</code></p>
<h2 id="Rebase操作"><a href="#Rebase操作" class="headerlink" title="Rebase操作"></a>Rebase操作</h2><p>如果执行<code>git pull --rebase</code>，提交线图会变成如下所示：</p>
<div align="center"><img src="http://chuquan-public-r-001.oss-cn-shanghai.aliyuncs.com/daily-images/git-rebase-merge-example-rebase.png" alt=""></div>

<p><strong>分析</strong><br>提交线图中，本地的新提交<code>F</code>，<code>G</code>变成了两个新的提交<code>F&#39;</code>，<code>G&#39;</code>，拼接在了<code>C</code>后面，多余的分叉也删除了。提交线变得非常清晰。</p>
<h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><p>从上述对比可以看出，rebase操作会将本分支的新提交删除并生成新的提交。所以rebase操作比较适用于将一些零碎的提交进行合并清理。比如：在push之前进行整理。</p>
<p>那么merge操作意义何在呢？  </p>
<p>merge操作与rebase操作相反，它可以保留了提交线图的分叉，并生成一个新的提交。这种场景适合用于大的分支合并。这样，我们可以在提交线图中看到项目开发迭代过程中经历过哪些feature分支等等。</p>
<p><strong>注意</strong><br>如果执行merge操作之前，提交线图是分叉的（即不是<code>fast-forward</code>，如<strong>场景设想</strong>的情形），执行<code>git merge</code>操作，是会达保留分支的目的。  </p>
<p>但是执行merge操作之前，提交线图不是分叉的（即是<code>fast-forward</code>，如下上图所示），此时执行<code>git merge</code>操作的效果如下下图所示，分支是不会保留的。</p>
<div align="center"><img src="http://chuquan-public-r-001.oss-cn-shanghai.aliyuncs.com/daily-images/git-rebase-merge-example01.png" alt=""></div>

<div align="center"><img src="http://chuquan-public-r-001.oss-cn-shanghai.aliyuncs.com/daily-images/git-rebase-merge-example03.png" alt=""></div>

<p>在<code>fast-forward</code>情况下进行合并，我们需要执行如下命令来保留分支。执行后的提交线图如下所示。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git merge --no-ff</span><br></pre></td></tr></table></figure></p>
<div align="center"><img src="http://chuquan-public-r-001.oss-cn-shanghai.aliyuncs.com/daily-images/git-rebase-merge-example02.png" alt=""></div>

<p>（完）</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://chuquan.me/2017/09/17/graduated-for-two-month/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="包楚权">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/slamdunk.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="包楚权的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/17/graduated-for-two-month/" itemprop="url">写在入职两个月之际</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-17T11:40:03+08:00">
                2017-09-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/生活/" itemprop="url" rel="index">
                    <span itemprop="name">生活</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>学生生涯结束至今已有两月有余，偶尔还是会念想在北大那些瞬间，好在入职的公司在各方面都非常令我满意，不至于用怀念来解忧生活。  </p>
<h1 id="关于工作"><a href="#关于工作" class="headerlink" title="关于工作"></a>关于工作</h1><hr>
<p>说说现在的公司吧，一家处于成长期的K12在线教育创业公司——猿辅导，坐落在阜通站旁的利星行中心。公司主要有粉笔网、猿题库、猿辅导、小猿搜题等几款在线教育App。  </p>
<p>7月10日刚入职，我被安排到小猿搜题研发部的iOS开发岗。作为一名无任何iOS开发经验的应届毕业生，我的压力还是蛮大的，毕竟这对我来说是一个全新的挑战。好在我的同事们都非常nice，尤其是我的mentor——展哥，还有坐我旁边的元老级程序媛——琳洁。每每我在学习以及开发过程中有任何问题，他们都会不厌其烦地给我讲解，真的非常感谢他们！相比我之前实习的那家公司（某度），就同事间的关系来说，真是不知道高到哪里去了。  </p>
<p>我们研发部研发人员大概不到20人，4个iOS，3个安卓，5个后台，3个前端，3个测试，当然其中也有些人前后端都做，小组内同事大都是硕士以上学历。研发部内部分为三个小团体：产品、客户端、服务器端。iOS、安卓、测试共同组成一个客户端，组内气氛每天都很欢乐，不至于每天工作得很压抑。    </p>
<p>公司的工作制度也是比较和谐的。朝十晚七，不打卡，无KPI，不提倡加班。每天上午会有一个几分钟的站会，每个人说一下自己前一天的任务完成情况，以及当天的任务安排。我们平时也没有那么多的会，除非PM有新的产品需求，并且不提倡大家携带笔记本开会，从而提高开会效率。在某度，几乎每天都有各种会议，开会的时候大家基本都会携带笔记本，自己干自己的事。过多的会议真的会严重碎片会工作时间，降低工作效率。在某度实习期间，一个月的代码量都不如我现在一个星期的代码量。  </p>
<p>周二下午我们小组会对PM提出的产品需求汇集、拆分，并进行难度评分，最后予以分配。站会也是就是对这些任务进展的汇报及安排。如此一套Scrum开发流程，可以极大地提高我们的工作效率。工作效率高了，也就没有必要加班了，生活也不是那么枯燥乏味了。  </p>
<p>入职两个月以来，我能感受到自己的成长非常大。真正的项目实践总是能让你对一些东西有更深入的理解，比如git、gerrit等。公司对于项目管理使用了很多开源的工具，并进行了重组。希望在之后的日子里，我能对这些工具平台也有更深一步的了解。  </p>
<h1 id="关于生活"><a href="#关于生活" class="headerlink" title="关于生活"></a>关于生活</h1><hr>
<p>女票家给她在塘溪津门买了一套房，首付30%，2.2w/平米。接下来由我们两来还房贷，我每个月还贷1w，房租3k多，虽说生活还没到捉襟见肘的地步，但是能省则省吧。公积金也准备提出来了，只有这样，生活还能够多出一些积蓄来。当自身背负了如此沉重的房贷后，事业的发展总是会受到一定的影响，在面临选择的时候，会变得格外谨慎、犹豫，未来的我也许也会面临这样的情境。  </p>
<p>该吐槽的还是要得吐槽。政府现在真的是把人往绝境里逼，虽说出台了一套又一套的房价抑制政策，然而所谓的政策只不过是稳定人心的幌子，韭菜该割还是要割，房价只是减速增长而已。房价的增长比工资的增长还快，买不起房的人永远都买不起房。</p>
<p>今年北京市的高考状元接受采访时的言论真的是一针见血。在教育方面上，他们享受着农村孩子无法想象的资源优势，进入名校对他们来说只是水到渠成的问题。事实上，在北大求学期间，我也意识到这个问题：周围的同学，尤其是本科生，大多数的家庭要么是高识分子，要么是高收入家庭，农村而来学生真的很少。现在社会频频出现学生入学如调查家庭背景的案例，很明显，学校在区分学生家庭所处的社会阶级，这样的情况在未来还会继续蔓延。富人越富，穷人愈穷，下一代亦是如此，阶级的固化正在酝酿。也许我们这一代还有不少能从底层往上爬，但后来的人真的将越来越难…</p>
<p>（完）</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://chuquan.me/2017/09/10/git-branching-model/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="包楚权">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/slamdunk.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="包楚权的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/10/git-branching-model/" itemprop="url">Git 分支模型</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-10T20:01:36+08:00">
                2017-09-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/软件/" itemprop="url" rel="index">
                    <span itemprop="name">软件</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>我们公司的软件产品迭代采用的是scrum敏捷开发流程，代码使用git进行版本管理。在新人最初的几次开发任务中，我对于git的使用也仅限于一些基本的命令，包括：add、commit、rebase、cherry-pick、push、checkout等等。<br>直到有一天，我发现远程分支上存在着一些历史feature分支，这对于我这个初入职场的小白来说还是有些好奇：feature分支在本地建立不就行了吗？为何还需要推送到远程仓库？<br>带着这一些列的疑问，我仔细研究了一些我们基于gerrit的code review流程，终于明白了为何会有feature远程分支。这一切都与git的分支模型有关。<br>期间，我在一个英文博客上看到了一篇关于<a href="http://nvie.com/posts/a-successful-git-branching-model/" target="_blank" rel="noopener">git分支模型</a>的介绍，看完后觉得不错，对其进行简要地整理，以呈现给大家。</p>
<div align="center"><img src="http://chuquan-public-r-001.oss-cn-shanghai.aliyuncs.com/blog-images/git-branch-model.png?x-oss-process=image/resize,w_500" alt=""></div>

<h1 id="分权集中"><a href="#分权集中" class="headerlink" title="分权集中"></a>分权集中</h1><p>下图中心的仓库，是我们建立并在使用的仓库，具有分支模型，其通常会被认为是“真正的中心仓库”。然而，事实上，其仅仅是被<strong>认为</strong>是中心仓库而已，因为git作为一个分布式版本控制系统（DVCS），在技术层面并不存在哪个仓库是中心仓库。而这个被认为是“中心”的仓库，我们更愿意称之为<strong>origin</strong>，这个名字对于所有git用户都是很熟悉的。  </p>
<div align="center"><img src="http://chuquan-public-r-001.oss-cn-shanghai.aliyuncs.com/blog-images/git-center-decenter.png?x-oss-process=image/resize,w_400" alt=""></div>

<p>每个开发者都会从origin进行pull或向其进行push操作。但是除了与origin具有push-pull关系之外，开发者们还可能从其他同级的伙伴那里pull最新的改动，从而形成一个sub team。比如，对于两个以上的开发者，在过早地向origin推送开发进展之前，其可以开辟一个新的feature分支来共同工作。如上图所示，存在着这样几个开发小组：Alice &amp; Bob，Alice &amp; David，Clair &amp; David。  </p>
<p>从技术角度而言，这仅仅意味着Alice定义了一个远程仓库，名字是Bob，其指向了Bob的仓库，反之亦然，仅此而已。</p>
<h1 id="主分支"><a href="#主分支" class="headerlink" title="主分支"></a>主分支</h1><p>归根到底，开发模型也受到了上述思想的影响。在中心仓库中，在其无限的生命周期中，始终存在着两条主分支：  </p>
<ul>
<li><strong>master</strong></li>
<li><strong>develop</strong></li>
</ul>
<div align="center"><img src="http://chuquan-public-r-001.oss-cn-shanghai.aliyuncs.com/blog-images/git-main-branches.png?x-oss-process=image/resize,w_250" alt=""></div>

<p>大家对<strong>origin</strong>上的<strong>master</strong>分支应该并不陌生。而另一个与之平行的分支，我们称之为<strong>develop</strong>分支。  </p>
<p><strong>origin/master</strong>：在这个分支上，源代码的<strong>HEAD</strong>指针的指向始终都是就绪/可发布的产品状态。  </p>
<p><strong>origin/develop</strong>：在这个分支上，源代码的<strong>HEAD</strong>指针的指向始终都是下一个版本的产品状态。</p>
<p>当<strong>develop</strong>分支的源代码到达某一个可发布的稳定点时，所有的改动都应该合并到<strong>master</strong>分支，然后打上版本的tag标签。  </p>
<p>因此，每次将改动合并至<strong>master</strong>分支时，意味着一个新版本的诞生。我们往往对这个过程控制得非常严格。所以每次<strong>master</strong>分支上有commit时，我们都应该使用git hook脚本来自动编译、发布软件至产品服务器上。  </p>
<h1 id="支持分支"><a href="#支持分支" class="headerlink" title="支持分支"></a>支持分支</h1><p>与主分支<strong>master</strong>、<strong>develop</strong>相邻的则是各种支持分支，用于帮助团队成员之间进行平行开发，跟踪功能，准备产品发布以及帮助修复在线产品的一些Bug。与主分支不同，这些分支总是具有有限的生命周期，因为它们最终都是要被删除的。  </p>
<p>我们可能用到的几种不同的支持分支：  </p>
<ul>
<li><strong>Feature分支</strong></li>
<li><strong>Release分支</strong></li>
<li><strong>Hotfix分支</strong></li>
</ul>
<p>上述的每一个分支都具有特定的目的，并且必须遵守严格的规则。比如：哪些分支可以是它们的源头分支，哪些分支必须是它们的合并目标。  </p>
<p>当然，从技术角度来说，这些分支并没有什么特殊之处。所谓的分支类型只是我们根据如何使用它们而进行分类的。  </p>
<h2 id="Feature分支"><a href="#Feature分支" class="headerlink" title="Feature分支"></a>Feature分支</h2><p><strong>规则</strong>：  </p>
<blockquote>
<p>可以源自<strong>develop</strong>分支<br>必须合并到<strong>develop</strong>分支<br>命名：除<strong>master</strong>，<strong>develop</strong>，<strong>release-*</strong>，<strong>hotfix-*</strong>之外</p>
</blockquote>
<div align="center"><img src="http://chuquan-public-r-001.oss-cn-shanghai.aliyuncs.com/blog-images/git-feature-branches.png?x-oss-process=image/resize,w_125" alt=""></div>

<p>Feature分支（也称：topic分支）用来为即将发布的版本或更远的版本开发新的feature。当开发一个新的功能的时候，我们不知道这个功能会被纳入哪个目标版本。Feature分支的本质就是，只要该功能处于开发阶段，feature分支就会存在，并最终会被合并至<strong>develop</strong>分支（以确保将新功能添加到即将发布的版本中）或者丢弃（在实验失败的情况下）。  </p>
<p>Feature分支通常只存在与开发者自己的仓库中，而不是<strong>origin</strong>。</p>
<h3 id="创建feature分支"><a href="#创建feature分支" class="headerlink" title="创建feature分支"></a>创建feature分支</h3><p>当开始开发一个新的功能时，需要从<strong>develop</strong>主分支中开辟一个新分支。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -b myfeature develop //表示切换到一个新的分支“myfeature”</span><br></pre></td></tr></table></figure></p>
<h3 id="将完成的功能纳入develop"><a href="#将完成的功能纳入develop" class="headerlink" title="将完成的功能纳入develop"></a>将完成的功能纳入develop</h3><p>完成的功能可以合并至develop分支，以加入即将发布的版本之中。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout develop  //切换至develop分支</span><br><span class="line">$ git merge --no-ff myfeature //</span><br><span class="line">$ git branch -d myfeature   //删除myfeature分支</span><br><span class="line">$ git push origin develop</span><br></pre></td></tr></table></figure></p>
<p><strong>–no-ff</strong>选项会在合并分支时创建一个新的commit对象，即使合并可以是一次fast-forward操作。这可以避免丢失feature分支的历史存在信息，并将该feature分支上的所有commit放在在一起。</p>
<div align="center"><img src="http://chuquan-public-r-001.oss-cn-shanghai.aliyuncs.com/blog-images/git-merge-no-ff-comare.png?x-oss-process=image/resize,w_400" alt=""></div>

<p>如上图所示，相比较而言，后面一种情况是不可能从git历史记录中看到哪些提交对象一起实现了一个功能，你必须手动读取所有日志信息。在后一种情况下，恢复整个功能（即一组提交）是非常困难的，而如果使用了<strong>–no-ff</strong>选项，则很容易实现。</p>
<p>当然，这会创建一些空的commit对象，但收益远大于成本。  </p>
<h2 id="Release分支"><a href="#Release分支" class="headerlink" title="Release分支"></a>Release分支</h2><p><strong>规则</strong></p>
<blockquote>
<p>可以源自<strong>develop</strong>分支<br>必须合并到<strong>develop</strong>分支和<strong>master</strong>分支<br>命名：<strong>release-*</strong></p>
</blockquote>
<p>Release分支用于支持准备新的产品版本，它们允许对版本进行小错误修复和元数据准备（版本号，构建日期等）。通过在Release分支上进行所有这些工作，<strong>develop</strong>分支会被清理以接收下一个大版本的功能。  </p>
<p>当<strong>develop</strong>分支达到了新版本的期望状态时，即可从<strong>develop</strong>分支开辟新的release分支。当然，必须要等到所有待发布的功能合并至<strong>develop</strong>分支之后才可以。  </p>
<p>正是在release分支的开始，即将发布的版本会被分配版本号。直到这一刻起，<strong>develop</strong>分支“下一个版本”的改动。但是“下一个版本”会变为0.3还是1.0，需要等到release分支开始才知道。这是在release分支开始时，由版本规则决定的。  </p>
<h3 id="创release分支"><a href="#创release分支" class="headerlink" title="创release分支"></a>创release分支</h3><p>Release分支从<strong>develop</strong>分支创建而来。例如，1.1.5版本是当前的产品版本，我们即将有一个大的版本。<strong>develop</strong>已经为“下一个版本”准备就绪了，并且我们已经决定这将成为1.2版本（而不是1.1.6或2.0）。所以我们开辟一个分支，并予以相应的版本号。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -b release-1.2 develop å</span><br><span class="line">$ ./bump-version.sh 1.2 </span><br><span class="line">$ git commit -a -m <span class="string">"Bumped version number to 1.2"</span></span><br></pre></td></tr></table></figure></p>
<h3 id="结束release分支"><a href="#结束release分支" class="headerlink" title="结束release分支"></a>结束release分支</h3><p>当release分支的状态已经准备好成为y一个真正的版本，需要完成一些操作。首先，将release分支合并至<strong>master</strong>分支（<strong>master</strong>上的每一个commit都是一个新的版本）。然后，<strong>master</strong>上的commit必须被打上标签，以便参考历史版本。最后，将在release分支上作出的改动合并到<strong>develop</strong>分支上，以便未来的版本还包含这些错误修复。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// step 1</span><br><span class="line">$ git checkout master å</span><br><span class="line">$ git merge --no-ff release-1.2</span><br><span class="line">// step 2</span><br><span class="line">$ git tag -a 1.2</span><br><span class="line">// step 3</span><br><span class="line">$ git checkout develop</span><br><span class="line">$ git merge --no-ff release-1.2</span><br><span class="line">// 完成后，我们可以将release分支删除</span><br><span class="line">$ git branch -d release-1.2</span><br></pre></td></tr></table></figure>
<h2 id="Hotfix分支"><a href="#Hotfix分支" class="headerlink" title="Hotfix分支"></a>Hotfix分支</h2><p><strong>规则</strong></p>
<blockquote>
<p>可以源自<strong>develop</strong>分支<br>必须合并到<strong>develop</strong>分支和<strong>master</strong>分支<br>命名：<strong>hotfix-*</strong></p>
</blockquote>
<div align="center"><img src="http://chuquan-public-r-001.oss-cn-shanghai.aliyuncs.com/blog-images/git-hotfix-branches.png?x-oss-process=image/resize,w_250" alt=""></div>


<p>Hotfix分支与release分支非常相似，其也是用于为新的产品版本做准备，尽管是计划之外的。它们是对发布版本的不良状态作出的回应。当产品版本中的一个关键bug必须要被修复时，可以从<strong>master</strong>分支上相应的tag标签中开辟一个hotfix分支。</p>
<p>Hotfix分支的本质是可以使<strong>develop</strong>分支上的工作得以继续，而另外有人进行bug修复。</p>
<h3 id="创建hotfix分支"><a href="#创建hotfix分支" class="headerlink" title="创建hotfix分支"></a>创建hotfix分支</h3><p>Hotfix分支从<strong>master</strong>分支创建而来。例如，1.2版本是当前产品的版本号，正在在线运行，由于服务器bug出现了一些问题。但是<strong>develop</strong>分支上的改动还不稳定。我们需要开辟一个hotfix分支来进行bug修复。  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -b hotfix-1.2.1 master</span><br><span class="line">$ ./bump-version.sh</span><br><span class="line">$ git commit -a m <span class="string">"Bumped version number to 1.2.1"</span></span><br><span class="line">// 修复bug并commit</span><br><span class="line">$ git commit -m <span class="string">"Fixed server production problem"</span></span><br></pre></td></tr></table></figure>
<h3 id="结束hotfix分支"><a href="#结束hotfix分支" class="headerlink" title="结束hotfix分支"></a>结束hotfix分支</h3><p>当完成bug修复之后，hotfix分支需要合并到<strong>master</strong>分支，当然也需要合并至<strong>develop</strong>分支，这与release分支是非常相似的。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// step 1: 合并至master，打上版本标签</span><br><span class="line">$ git checkout master</span><br><span class="line">$ git merge --no-ff hotfix-1.2.1</span><br><span class="line">$ git tag -a 1.2.1</span><br><span class="line">// step 2: 合并至develop</span><br><span class="line">$ git checkout develop</span><br><span class="line">$ git merge --no-ff hotfix-1.2.1</span><br><span class="line">// step 3: 删除hotfix分支</span><br><span class="line">$ git branch -d hotfix-1.2.1</span><br></pre></td></tr></table></figure>
<p>这里有一个例外需要注意，<strong>当一个release分支当前还存在时，hotfix分支的修改应该合并至release分支，而不是develop分支</strong>。因为release分支完成后，需要合并至<strong>develop</strong>分支。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/slamdunk.png"
               alt="包楚权" />
          <p class="site-author-name" itemprop="name">包楚权</p>
           
              <p class="site-description motion-element" itemprop="description">吸收、沉淀、积累</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">32</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">8</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">23</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/baochuquan" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      GitHub
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://weibo.com/baochuquan" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                    
                      微博
                    
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">包楚权</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.2"></script>



  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

</body>
</html>
